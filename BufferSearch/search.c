#include <regex.h>
#include <sys/types.h>
#include <dirent.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <pthread.h>


typedef struct file_stack{

    char* name;
    short type;   // 1 - file, 2 - directory
    struct file_stack* next;

}__attribute__((packed)) FILE_STACK;


FILE_STACK* top = NULL;

pthread_mutex_t operation_lock;



FILE_STACK* push(FILE_STACK* top, char* name, short type){
    pthread_mutex_lock(&operation_lock);
    if(top == NULL){
        FILE_STACK* node = malloc(sizeof(FILE_STACK));

        node->name = malloc(strlen(name) + 1);
        node->name[strlen(name)] = '\0';
        strcpy(node->name, name);
        node->type = type;

        node->next = NULL;    
        return node;
    }

    FILE_STACK* node = malloc(sizeof(FILE_STACK));

    node->name = malloc(strlen(name) + 1);
    node->name[strlen(name)] = '\0';
    strcpy(node->name, name);
    node->type = type;

    node->next = top;
    pthread_mutex_unlock(&operation_lock);
    return node;
}


FILE_STACK* pop(FILE_STACK* top){
    pthread_mutex_lock(&operation_lock);
    if(top == NULL){
        return NULL;
    }

    FILE_STACK* previous_top = top;

    top = top->next;

    memset(previous_top->name, 0, strlen(previous_top->name));

    free(previous_top->name);

    free(previous_top);

    pthread_mutex_unlock(&operation_lock);
    return top;

}


void init(FILE* top){


    pthread_t push_thread;
    pthread_t pop_threads[5];


    return;

}


int main(int argc, char *argv[])
{

    if(argc < 2 ){
        perror("Error. Pleae use the following format: ./search <directory>");
        exit(EXIT_FAILURE);
    }

    pthread_mutex_init(&operation_lock, NULL);

    

    top = push(top, argv[1], 2);




    // // push(argv)

    // FILE_STACK* top = NULL;
    
    // top = push(top, "philip", 1);
    // top = push(top, "Sachi", 2);

    // printf("top: %s\n", top->name);

    // top = pop(top);
    // top = pop(top);
    // top = pop(top);

    return 0;
}
