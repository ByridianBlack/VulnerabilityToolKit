#include "network.h"
#include <string.h>
#include <stdio.h>

uint32_t crc32_calculate(uint32_t accumulator, uint8_t* data_blk, uint32_t data_blk_size){

    register uint32_t i, j;

    for(j = 0; j < data_blk_size;j++){
        i = ((uint32_t) (accumulator >> 24) ^ *data_blk++) & 0xFF;
        accumulator = (accumulator << 8) ^ crc32_tab[i];
    }
    return accumulator;
}


ssize_t secure_send(char* destination_path, pid_t client_id, void* data_buffer, uint64_t data_length){


    if(data_buffer == NULL){
        return -1;
    }
    NETWORK_PACKET packet;
    packet.d_pid = destination;
    packet.MAGIC = 0x50434F53;
    packet.s_pid = client_id;


    if(strlen(destination_path) > 512){
        printf("Destination Math to big. Max size 512 characters\n");
        return -1;
    }

    strcpy(packet.destination_path, destination_path);
    
    
    
    

    if(data_length < 236){
        
        /*
            There needs to be some form of encryption routine here first.
        */
        packet.data = data_buffer;
        packet.sequence_number = 0;
        int crc32_checksum = 0;
        packet.checksum = crc32_calculate(crc32_checksum, data_buffer, data_length);

        send(server_pid, &packet, BLOCK_SIZE, 0);

    }
    

}


int main(int argc, char const *argv[])
{

    
    return 0;
}
