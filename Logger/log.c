#include "log.h"

int logging_fd;

uint8_t ENABLED     = 0x1;
uint8_t SUCCESS_LOG = 0x2;
int8_t FAILURE_LOG  = -1;

uint8_t flags = 0x0;


enum Levels{
    WARNING = 0,
    ERROR   = 1,
    INFO    = 2
};

void disable_log(){
    flags = flags ^ 0x1;
}

void enable_log(){
    flags = flags ^ 0x1;
}

void enable_color(){
    flags = flags ^ (1 << 1);
}

void disable_color(){
    flags = flags ^ (1 << 1);
}

void enable_console_print(){
    flags = flags ^ (1 << 2);
}

void disable_console_print(){
    flags = flags ^ (1 << 2);
}

uint8_t extract_flag_bit(uint8_t bit_space){
    return flags & (1 << bit_space);
}

int8_t write_log(char* log_info, uint8_t level){
    

    if(extract_flag_bit(0) == 0){
        return SUCCESS_LOG;
    }

    char MESSAGE[512];
    memset(MESSAGE, 0, 512);
    int wc;

    switch(level){
        case WARNING:
            
            sprintf(MESSAGE, "[WARNING]: %s\n", log_info);
            if((wc = write(logging_fd, MESSAGE, strlen(MESSAGE))) < 0){
                return FAILURE_LOG;
            }
            break;
        case ERROR:
            sprintf(MESSAGE, "[ERROR]: %s\n", log_info);
            if((wc = write(logging_fd, MESSAGE, strlen(MESSAGE))) < 0){
                return FAILURE_LOG;
            }
            break;
        case INFO:
            sprintf(MESSAGE, "[INFO]: %s\n", log_info);
            if((wc = write(logging_fd, MESSAGE, strlen(MESSAGE))) < 0){
                return FAILURE_LOG;
            }
            break;
        default:
            sprintf(MESSAGE, "[ERROR]: %s\n", "Logging level not defined!");
            if((wc = write(logging_fd, MESSAGE, strlen(MESSAGE))) < 0){
                return FAILURE_LOG;
            }
            break;
    }

    return 1;
}